# A. Penetration Testing Overview
## Pentest vs Red Teaming vs Vulnerability Assessment
* In a `red team` assessment, the process is scenario-based, and focus on vulnerabilities leveraged to reach a specific goal. (e.g. accessing the CEO's inbox)
* In a `pentest`, the goal is to uncover ALL vulnerabilities in the scope to improve security for the tested systems.
* In a `vulnerability assesment`, purely automated tools are used.
	* [OpenVAS](https://greenbone.github.io/docs/latest/background.html#architecture)
	* [Nessus](https://www.tenable.com/products/nessus)

For both pentest and va, a mutual agreement is needed. If not, it is a criminal offense.
## Risk Management
Generally speaking, a pentest is included in a company strategy of `risk management`.
Main goal of IT security risk management:
* identify
* evaluate
* mitigate
any potential risks that could damage
* confidentiality
* integrity
* availability
of an organization's information systems and data,
And reduce the overall risk to an acceptable level.

Risk can be transfered to other parties by a contract.
## Testing Methods
### External
Perspective of an anonymous user on the Internet. What most of customers want, to be ensured against attacks on the external network perimeter.

Stealth: some clients don't care at all, others prefer an hybrid approach, with increased noise, to test their detection capabilities.

To avoid being blocked by our ISP, we can use a VPN connection or a VPS

Goal: access external-facing hosts, obtain sensitive data, or gain access to the internal network
### Internal
In contrast, from within the corporate network. 
May be executed: 
- after successfully penetrating the corporate network via the external pentest
- starting from an assumed breach scenario
May also request access to isolated systems with no internet access whatsoever, which usually requires physical presence.
## Types of Penetration Testing
Determines how much information is made available ot us.
- **Blackbox:** Minimal. Only the essential information, such as IP addresses and domains, is provided.
- **Greybox:** Extended. In this case, we are provided with additional information, such as specific URLs, hostnames, subnets, and similar.
- **Whitebox:** Maximum. Here everything is disclosed to us. This gives us an internal view of the entire structure, which allows us to prepare an attack using internal information. We may be given detailed configurations, admin credentials, web application source code, etc.
- **Red-Teaming:** May include physical testing and social engineering, among other things. Can be combined with any of the above types.
- **Purple-Teaming:** It can be combined with any of the above types. However, it focuses on working closely with the defenders.
## Types of Testing Environments
| Network | Web App | Mobile            | API               | Thick Clients |
| ------- | ------- | ----------------- | ----------------- | ------------- |
| IoT     | Cloud   | Source Code       | Physical Security | Employees     |
| Hosts   | Server  | Security Policies | Firewalls         | IDS/IPS       |
# B. Laws and Regulations
You have to comply to the laws for computer-related activities, copyright protection, interception of electronic communications, use and disclosure of protected health information, and collection of personal information from children, respectively.
We must be aware of them or face a risk of civil / criminal penalties.

## Key Laws and Regulations by Region

### USA
*   **CFAA (Computer Fraud and Abuse Act):** Criminalizes unauthorized computer access. Controversial due to broad definitions potentially affecting security research.
*   **DMCA (Digital Millennium Copyright Act):** Prohibits circumventing copyright protection measures (e.g., encryption). Researchers must be cautious not to violate this, even for research purposes.
*   **ECPA (Electronic Communications Privacy Act):** Regulates interception of electronic communications, requiring consent. Prohibits using illegally intercepted communications in court.
*   **HIPAA (Health Insurance Portability and Accountability Act):** Governs the use/disclosure of protected health information (PHI), requiring specific safeguards for electronic PHI (e.g., encryption, access logs). Non-compliance carries severe penalties.
*   **COPPA (Children's Online Privacy Protection Act):** Regulates collecting personal information from children under 13. Researchers must avoid collecting such data without compliance.

### Europe
*   **GDPR (General Data Protection Regulation):** Regulates handling personal data of EU citizens, strengthening individual rights. Applies globally to companies processing EU citizen data, with hefty fines for non-compliance.
*   **NISD (Network and Information Systems Directive):** Requires essential service operators and digital service providers to implement security measures and report incidents. Applies to security researchers.
*   **Cybercrime Convention:** First international treaty on cybercrime, enabling cross-country cooperation in investigations and prosecutions.
*   **E-Privacy Directive:** Regulates personal data processing in the electronic communication sector within the EU.

### UK
*   **Computer Misuse Act 1990:** Criminalizes unauthorized computer access, data modification, and misuse for fraud. Allows device confiscation.
*   **Data Protection Act 2018:** Outlines individual rights over personal data (access, rectification, objection) and obligations for data processors (security, transparency).
*   **Human Rights Act 1998 (HRA):** Incorporates the European Convention on Human Rights into UK law, guaranteeing fundamental rights (fair trial, privacy, expression).
*   **Police and Justice Act 2006:** Reformed criminal justice, creating offenses (inciting religious hatred), establishing SOCA and a DNA database, and tackling anti-social behavior.
*   **Investigatory Powers Act 2016 (IPA):** Regulates state investigatory powers (hacking, surveillance) and mandates data retention by communication providers.
*   **Regulation of Investigatory Powers Act 2000 (RIPA):** Regulates covert investigatory techniques used by public authorities.

### India
*   **Information Technology Act 2000:** Legally recognizes electronic transactions and criminalizes hacking/unauthorized access.
*   **Personal Data Protection Bill 2019 (Proposed):** Aims to protect personal data and penalize non-compliance.
*   **Indian Evidence Act 1872 & Indian Penal Code 1860:** Contain provisions applicable to cybercrime cases.

### China
*   **Cyber Security Law:** Framework for protecting critical information infrastructure and personal data, mandating security measures and incident reporting.
*   **National Security Law:** Criminalizes activities threatening national security, including hacking.
*   **Anti-Terrorism Law:** Criminalizes activities supporting terrorism, including hacking.
*   **Measures for Security Assessment of Cross-border Transfer:** Regulates cross-border transfer of personal/important data, requiring security assessments and approval.
*   **State Council Regulation on Protection of Critical Information Infrastructure:** Regulates protection of critical infrastructure, mandating security measures and reporting.
## Precautionary Measures during Penetration Tests
* Obtain written consent from the owner or authorized representative of the computer or network being tested.
* Stay in the consented scope and respect limitations.
* Take prevention mesures to avoid causing damage to systems / networks being tested.
* Do not access, use or disclose personal data or any other information obtained during the test without permission.
* Do not intercept electronic communications without the consent of one of the parties to the communication.
* Do not conduct testing on systems or networks covered by the Health insurance Portability and Accountability Act without proper authorization.
# C. Laws and Regulations
process = directed sequence of events.
* `Deterministic` process: Each state is causally dependent on and determined by other previous states and events.
* `Stochastic` process: One state follows from other states only with a certain probability.

`A penetration testing process is defined by successive steps and events performed by the penetration tester to find a path to the predefined objective.`

## Stages
![[pentest_stages.png]]
### Pre-Engagement
*Educating the client and adjusting the contract.*
All necessary tests and their components are strictly defined and contractually recorded. In a face-to-face meeting or conference call, many arrangements are made, such as:
- `Non-Disclosure Agreement`
- `Goals`
- `Scope`
- `Time Estimation`
- `Rules of Engagement`
### Information Gathering
*How we obtain information about the necessary components in various ways.*
We search for information about the target company, software hardware in use, to find potential security gaps that we may be able to leverage for a foothold.
### Vulnerability Assessment
*Vulnerability assessment is the evaluation of potential vulnerabilities, both manually and through automated means.*
We analyze results from Information Gathering stage, looking for known vulnerabilities in the systems, applications, and various versions of each to discover possible attack vectors.
This allows us to evaluate the threat level and susceptibility of a company's network infrastructure to cyber-attacks.
### Exploitation
*We use the results to test our attacks against the potential vectors and execute them against the target systems to gain initial access to those systems.*
### Post-Exploitation
*Improve and maintain*
We have access to the exploited machine and ensure that we still have access even if modifications and changes are made. 
We may try to escalate our privileges, and hunt for sensitive data or protected stuff.
Sometimes performed to demonstrate the impact of our access to the client.
Other times we may perform it as an input for Lateral Movement.
### Lateral Movement
*Movement within the internal network of our target company to access additional hosts at the same or a higher privilege level.*
Often an iterative process combined with post-exploitation activities until we reach our goal.

> For example, we gain a foothold on a web server, escalate privileges and find a password in the registry. 
> We perform further enumeration and see that this password works to access a database server as a local admin user. 
> From here, we can pillage sensitive data from the database and find other credentials to further our access deeper into the network.

 In this stage, we will typically use many techniques based on the information found on the exploited host or server.